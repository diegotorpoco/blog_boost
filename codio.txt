import streamlit as st 
import openai
from PIL import Image
from mock_medium import image_gen
import numpy as np
from streamlit_card import card

st.set_page_config(layout="wide")

#Set title and subtitle
BASE_PROMPT_1 = "Write a 5 parragraphs essay about "
BASE_PROMPT_2 = "The essay should be linked to "
BASE_PROMPT_3 = "which is a "
BASE_PROMPT_4 = "Include a SEO optimized title. The style of the writing must be elegant but readable by a third grader. Separate the title from the blog, and keep the title short."
openai.api_key = "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"


def test_v2(company_input,topic_input,name_input):
    response_final = openai.Completion.create(
    model="text-davinci-003",
    prompt=BASE_PROMPT_1+topic_input+BASE_PROMPT_2+name_input+BASE_PROMPT_3+company_input+BASE_PROMPT_4+'\n\n',
    temperature=0.85, #0.55 fue bueno
    max_tokens=512,
    top_p=1,
    frequency_penalty=0,
    presence_penalty=0,
    best_of=1
    )
    return response_final


st.title("Blog Boost")
st.subheader("Blog Boost allows SMBs to create content in order to increase website traffic.")

### CAMBIOS LALALA

# Add a textbox and store the input in a variable
company_input = st.text_area("What is your business about?","",height=5,disabled=False,
placeholder="Buildspace is a e-learning community-driven webiste, that aids builders to unite and explore promising domains and ship meaningful products ")

topic_input = st.text_area("include the topic of the blog you want: ","",height=5,disabled=False,
placeholder="Edtech, Community, Web3, AI")

name_input = st.text_area("include the name of your company: ","",height=5,disabled=False,
placeholder="Buildspace, Facebook, Tesla")



col1, col2, col3 = st.columns(3, gap="small")

with col1:

    card(
    title="Instagram",
    text="Ads, posts, bios and DMs!",
    image="https://eltallerdehector.com/wp-content/uploads/2022/06/cd939-logo-instagram-png.png",
    url="https://www.google.com",
    )
   

with col2:
   
   card(
    title="Blogs",
    text="Titles, subtitles and blog!",
    image="https://cdn.mos.cms.futurecdn.net/uazw6gFQuEC29mxMM55Tpb.jpg",
    url="https://www.google.com",
    )

with col3:
   
   card(
    title="Coming soon!",
    text="Let us know what would you expect!",
    image="https://cdn.mos.cms.futurecdn.net/uazw6gFQuEC29mxMM55Tpb.jpg",
    url="https://www.google.com",
    )

if st.button("Generate Blog"):  
    # if (company_input) and (topic_input):
    with st.spinner('Wait for it...'):
        resp = test_v2(company_input=company_input,topic_input=topic_input,name_input=name_input)
        st.write(resp['choices'][0]['text'])
        
        texto_comp = resp['choices'][0]['text'][2:-1]
        if "\n" in texto_comp:
            index = texto_comp.find("\n")
        titulo = texto_comp[6:index]
        texto = texto_comp[index+2:-1]
        
        link = image_gen(titulo, "Prueba12345", texto, name_input, company_input, url_base='C:/Users/bruno/Desktop/Drive/Bruno/SEO/blog_boost/')
        #link = image_gen("prueba", "Prueba12345", "texto", name_input, company_input, url_base='C:/Users/bruno/Desktop/Drive/Bruno/SEO/blog_boost/')
        # imagennn = Image.open(link)
        st.image(np.asarray(link))
        st.success('Done!')